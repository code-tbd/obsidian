# 调度器
## 1. 调度循环
## 2. 调度触发
![调度触发时机](Pasted%20image%2020230801111252.png)  
**图 2-1 调度触发函数**  
### 2.1 `exitsyscall0` 
- 系统调用结束时，调用链为`runtime_entersyscall`->`entersyscall`->`reentersyscall`
- 从 cgo 调用退出时
### 2.2 `goexit0` 
- 协程结束退出
### 2.3 `goschedImpl` 
- 协作式调度
### 2.4 `goyield_m` 和 `goschedImpl` 类似
### 2.5 `mstart1` 
线程刚启动时会进行一次调度
### 2.6 `park_m` （重要）
park_m 主要发生在协程**暂时**挂起的情况，比如以下几种情况：
- 通道发送、通道接收时发生阻塞时
- gcworker 暂停工作时
- g 发生 panicwait 时，panicwait 指等待其 defer 链函数执行完成
- 在信号量上阻塞时，比如各种常见的 Mutex 锁
- 在 select 语句中阻塞时
- 通过 `time.Sleep` 调用休眠时
### 2.7 `preemptPark` 抢占式调度


### 2.1 `park_m` 调用时机

### 2.2 `exitsyscall0` 调用时机
- 系统调用结束时，调用链为`runtime_entersyscall`->`entersyscall`->`reentersyscall`
- 从 cgo 调用退出时
### 2.3 `goexit0` 调用时机
- g 正常退出时
- g 发生 panic 时
### 2.4 `goschedImpl` 调用时机
- 主动调用 `runtime.Sched` 时
- `goschedguarded_m` TODO
- `gopreempt_m` TODO
## 3. 唤醒时机
### 3.1 goready